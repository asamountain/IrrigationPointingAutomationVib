# ๐ F8 Training Mode - Visual Flow Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    IRRIGATION AUTOMATION SCRIPT                          โ
โ                      WITH F8 TRAINING MODE                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ START: Launch Script                                                     โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โผ
         โโโโโโโโโโโโโโโโโโโโโโ
         โ Environment Check   โ
         โโโโโโโโโโคโโโโโโโโโโโโ
                  โ
        โโโโโโโโโโโดโโโโโโโโโโ
        โ                   โ
        โผ                   โผ
   TRAINING=true      TRAINING not set
        โ                   โ
        โ                   โโโโโโโโโโโโโโโโ
        โ                                  โ
        โผ                                  โผ
โโโโโโโโโโโโโโโโโโโโโ              โโโโโโโโโโโโโโโโโโโโ
โ Training Mode ON  โ              โ Normal Mode      โ
โ (F8 Control)      โ              โ (Automatic)      โ
โโโโโโโโโโโฌโโโโโโโโโโ              โโโโโโโโโโฌโโโโโโโโโโ
          โ                                 โ
          โ        FARM LOOP STARTS         โ
          โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโ
                       โ
                       โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Navigate to Farm & Date     โ
        โโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Algorithm Analyzes Chart    โ
        โ  - Detect irrigation events  โ
        โ  - Find START valley (first) โ
        โ  - Find END peak (last)      โ
        โโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Calculate Click Coordinates โ
        โ  - FIRST: (x1, y1)          โ
        โ  - LAST: (x2, y2)           โ
        โโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโ
                      โ
         โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
         โ                         โ
         โผ                         โผ
   [TRAINING MODE?]          [NORMAL MODE]
         โ                         โ
         YES                       NO
         โ                         โ
         โผ                         โโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ              โ
โ ๐ trainAlgorithm()         โ              โ
โ                             โ              โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ โ              โ
โ โ Inject Visual UI:       โ โ              โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโ โ โ              โ
โ โ โ ๐ LEARNING MODE    โ โ โ              โ
โ โ โ Press [F8] to Resumeโ โ โ              โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโ โ โ              โ
โ โ                         โ โ              โ
โ โ ๐ข Predicted START      โ โ              โ
โ โ                         โ โ              โ
โ โ    [Chart Area]         โ โ              โ
โ โ                         โ โ              โ
โ โ ๐ด Predicted END        โ โ              โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ โ              โ
โ                             โ              โ
โ PAUSE & WAIT FOR USER       โ              โ
โ - Click START (optional)    โ              โ
โ - Click END (optional)      โ              โ
โ - Press F8 to continue      โ              โ
โโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ              โ
            โ                                โ
            โผ                                โ
    โโโโโโโโโโโโโโโโโ                       โ
    โ F8 Pressed?   โ                       โ
    โ (waitFor)     โ                       โ
    โโโโโโโโโฌโโโโโโโโ                       โ
            โ                                โ
            โผ                                โ
    โโโโโโโโโโโโโโโโโโโโโ                   โ
    โ Retrieve Clicks   โ                   โ
    โ - 0 clicks: OK    โ                   โ
    โ - 2 clicks: Apply โ                   โ
    โโโโโโโโโโฌโโโโโโโโโโโ                   โ
             โ                               โ
             โผ                               โ
    โโโโโโโโโโโโโโโโโโโโโโโโ                โ
    โ Calculate Offsets    โ                โ
    โ offset = user - pred โ                โ
    โโโโโโโโโโฌโโโโโโโโโโโโโโ                โ
             โ                               โ
             โผ                               โ
    โโโโโโโโโโโโโโโโโโโโโโโโ                โ
    โ Apply to Coordinates โ                โ
    โ x1 += offset.first.x โ                โ
    โ y1 += offset.first.y โ                โ
    โ x2 += offset.last.x  โ                โ
    โ y2 += offset.last.y  โ                โ
    โโโโโโโโโโฌโโโโโโโโโโโโโโ                โ
             โ                               โ
             โผ                               โ
    โโโโโโโโโโโโโโโโโโโโโโโโ                โ
    โ Save Training Data   โ                โ
    โ training-data.json   โ                โ
    โโโโโโโโโโฌโโโโโโโโโโโโโโ                โ
             โ                               โ
             โโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Perform Actual Clicks         โ
        โ  (with corrections if applied) โ
        โ  - Click FIRST at (x1, y1)     โ
        โ  - Click LAST at (x2, y2)      โ
        โโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโ
                        โ
                        โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Verify Table Data Updated     โ
        โโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโ
                        โ
                        โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Take Screenshot               โ
        โโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโ
                        โ
                        โผ
               โโโโโโโโโโโโโโโโโโ
               โ More Dates?    โ
               โโโโโโฌโโโโโโโโฌโโโโ
                    โ       โ
                   YES      NO
                    โ       โ
                    โ       โผ
                    โ  โโโโโโโโโโโโโโโ
                    โ  โ More Farms? โ
                    โ  โโโโโฌโโโโโโฌโโโโ
                    โ      โ     โ
                    โ     YES    NO
                    โ      โ     โ
                    โโโโโโโโ     โ
                                 โผ
                    โโโโโโโโโโโโโโโโโโโโโโ
                    โ Generate Summary   โ
                    โ - Farms processed  โ
                    โ - Charts clicked   โ
                    โ - Training saved   โ
                    โโโโโโโโโโโโฌโโโโโโโโโโ
                               โ
                               โผ
                    โโโโโโโโโโโโโโโโโโโโโโ
                    โ  END: Script Done  โ
                    โโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

KEY DECISION POINTS:

1๏ธโฃ  TRAINING_MODE Environment Variable
   โโ true โ Enable F8 training pause
   โโ false/unset โ Skip training, auto-click

2๏ธโฃ  F8 Key Press
   โโ Pressed โ Resume automation
   โโ (Waits indefinitely until pressed)

3๏ธโฃ  User Clicks
   โโ 0 clicks โ Use algorithm prediction as-is
   โโ 1 click โ Ignore (need 2 points)
   โโ 2+ clicks โ Calculate offsets and apply corrections

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

USER EXPERIENCE TIMELINE (Training Mode):

T+0s    Script starts, navigates to farm
T+5s    Chart loads, algorithm analyzes data
T+6s    Coordinates calculated
T+7s    ๐ BANNER APPEARS - Script PAUSES
        โ
        User reviews predicted points...
        โ
T+10s   User clicks START (yellow dot)
T+12s   User clicks END (red dot)
T+15s   User presses F8
        โ
T+16s   Offsets calculated and applied
T+17s   Training data saved
T+18s   Actual clicks performed
T+20s   Script continues to next date/farm

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

TRAINING DATA FLOW:

Algorithm           User             System
   โ                 โ                 โ
   โโ Predict โโโโโโโโค                 โ
   โ                 โ                 โ
   โ                 โโ Review โโโโโโโโโค
   โ                 โ                 โ
   โ                 โโ Click START โโโโค
   โ                 โโ Click END โโโโโโค
   โ                 โโ Press F8 โโโโโโโค
   โ                 โ                 โ
   โ                 โ                 โโ Calculate Offset
   โ                 โ                 โโ Save to JSON
   โ                 โ                 โโ Apply Correction
   โ                 โ                 โ
   โโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโ
```

---

## Code Execution Path

### Normal Mode
```javascript
// 1. Analyze
const clickResults = analyzeChart();

// 2. Click (no pause)
await page.mouse.click(clickResults.firstCoords.x, clickResults.firstCoords.y);
await page.mouse.click(clickResults.lastCoords.x, clickResults.lastCoords.y);
```

### Training Mode
```javascript
// 1. Analyze
const clickResults = analyzeChart();

// 2. PAUSE for training
if (CONFIG.trainingMode) {
  const training = await trainAlgorithm(page, farm, date, 
    clickResults.firstCoords, clickResults.lastCoords);
  
  // 3. Apply corrections
  if (training.hasCorrections) {
    clickResults.firstCoords.x += training.offsets.first.x;
    clickResults.lastCoords.x += training.offsets.last.x;
  }
}

// 4. Click (with corrections)
await page.mouse.click(clickResults.firstCoords.x, clickResults.firstCoords.y);
await page.mouse.click(clickResults.lastCoords.x, clickResults.lastCoords.y);
```

---

## State Machine

```
โโโโโโโโโโโโโโโโ
โ   INITIAL    โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโ     TRAINING_MODE=true
โ  ANALYZING   โโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโฌโโโโโโโโ                        โ
       โ TRAINING_MODE=false            โ
       โ                                โผ
       โ                        โโโโโโโโโโโโโโโโ
       โ                        โ   PAUSED     โ
       โ                        โ (Waiting F8) โ
       โ                        โโโโโโโโฌโโโโโโโโ
       โ                               โ F8 pressed
       โ                               โผ
       โ                        โโโโโโโโโโโโโโโโ
       โ                        โ  CORRECTING  โ
       โ                        โโโโโโโโฌโโโโโโโโ
       โ                               โ
       โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                       โ
                       โผ
               โโโโโโโโโโโโโโโโ
               โ   CLICKING   โ
               โโโโโโโโฌโโโโโโโโ
                      โ
                      โผ
               โโโโโโโโโโโโโโโโ
               โ   COMPLETE   โ
               โโโโโโโโโโโโโโโโ
```
